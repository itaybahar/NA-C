@page "/admin/dashboard"
@using Microsoft.AspNetCore.Authorization
@using Blazor_WebAssembly_Project.Components.helpers
@inject ILogger<AdminDashBoard> Logger
@attribute [Authorize(Roles = "Admin")]

<link href="css/dashboard.css" rel="stylesheet" />

<PageTitle>Dashboard - מנהל מערכת</PageTitle>

<div class="admin-layout">
    <!-- Top navbar with logo and tabs -->
    <header class="admin-header">
        <div class="admin-navbar">
            <div class="branding">
                <img src="images/pailM.png" alt="Logo" class="brand-logo" />
                <span class="brand-title pixel">ADMIN</span>
            </div>

            <nav class="dashboard-nav">
                <button class="dashboard-tab @(ActiveTab == "equipment" ? "active" : "")" @onclick='() => ChangeTab("equipment", 0)'>
                    <i class="bi bi-list-ul"></i> רשימת ציוד
                </button>
                <button class="dashboard-tab @(ActiveTab == "blacklist" ? "active" : "")" @onclick='() => ChangeTab("blacklist", 1)'>
                    <i class="bi bi-shield-x"></i> רשימה שחורה
                </button>
                <button class="dashboard-tab @(ActiveTab == "request" ? "active" : "")" @onclick='() => ChangeTab("request", 2)'>
                    <i class="bi bi-envelope"></i> בקשות הרשאה
                </button>
                <button class="dashboard-tab @(ActiveTab == "teams" ? "active" : "")" @onclick='() => ChangeTab("teams", 3)'>
                    <i class="bi bi-people"></i> ניהול צוותים
                </button>
                <button class="dashboard-tab @(ActiveTab == "users" ? "active" : "")" @onclick='() => ChangeTab("users", 4)'>
                    <i class="bi bi-person-gear"></i> ניהול משתמשים
                </button>
                <button class="dashboard-tab @(ActiveTab == "checkout" ? "active" : "")" @onclick='() => ChangeTab("checkout", 5)'>
                    <i class="bi bi-box-arrow-right"></i> הוצאת ציוד
                </button>
                <button class="dashboard-tab @(ActiveTab == "return" ? "active" : "")" @onclick='() => ChangeTab("return", 6)'>
                    <i class="bi bi-box-arrow-in-left"></i> החזרת ציוד
                </button>
                <button class="dashboard-tab @(ActiveTab == "add" ? "active" : "")" @onclick='() => ChangeTab("add", 7)'>
                    <i class="bi bi-plus-circle"></i> הוספת ציוד
                </button>
            </nav>
        </div>
    </header>

    <!-- Main content area -->
    <main class="admin-content">
        <div class="admin-content-container">
            @switch (ActiveTab)
            {
                case "equipment":
                    <EquipmentList />
                    break;
                case "blacklist":
                    <BlacklistView />
                    break;
                case "request":
                    <AdminRoleRequests />
                    break;
                case "teams":
                    <AddTeam />
                    break;
                case "users":
                    <UserRoleManager />
                    break;
                case "checkout":
                    <EquipmentCheckout />
                    break;
                case "return":
                    <EquipmentReturnForm />
                    break;
                case "add":
                    <AddEquipmentForm />
                    break;
            }
        </div>
    </main>
</div>

@code {
    private string ActiveTab = "equipment";

    protected override void OnInitialized()
    {
        // Set the initial tab
        Logger.LogInformation($"Initializing admin dashboard with tab: {ActiveTab}");
    }

    private void ChangeTab(string tabName, int tabIndex)
    {
        Logger.LogInformation($"Changing tab to: {tabName}");
        ActiveTab = tabName;
    }

    private int GetTabIndex(string tabName)
    {
        return tabName switch
        {
            "equipment" => 0,
            "blacklist" => 1,
            "request" => 2,
            "teams" => 3,
            "users" => 4,
            "checkout" => 5,
            "return" => 6,
            "add" => 7,
            _ => 0
        };
    }
}
